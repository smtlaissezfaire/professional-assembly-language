task :default => :compile

def basename(file)
  File.basename(file).gsub("\.s", "")
end

task :compile do
  Dir.glob("*.s").each do |file|
    basename = basename(file)

    sh "as -o #{basename}.o #{file} && ld -o #{basename} #{basename}.o"
  end
end

task :clean do
  sh "rm -f *.o"

  binaries = Dir.glob("*.s").map { |file| basename(file) }

  if binaries.any?
    sh "rm -f #{binaries.join(" ")}"
  end
end